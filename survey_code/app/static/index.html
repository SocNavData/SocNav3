<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://pyscript.net/releases/2024.11.1/core.css" />
    <script type="module" src="https://pyscript.net/releases/2024.11.1/core.js"></script>

    <title>Score Trajectory Dataset</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            min-height: 100vh;
            margin: 0;
        }
        .container {
            width: 100%;
            text-align: center;
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        .buttons {
            margin-top: 5px;
        }
        .responsive-video {
            width: 100%;
            height: auto;
            max-width: 650px;
        }
        button {
            padding: 10px 10px;
            margin: 5px;
            cursor: pointer;
        }
        #myCanvas {
            background-color: #ffffff;
            width: 340px;
            height: 120px;
            touch-action: none;
        }
    </style>
</head>
<body>

    <!-- [splashscreen] -->
    <!-- enabled = false -->
    <!-- <py-config>
        packages = ["numpy"]

        [splashscreen]
        enabled = false
        
        [[fetch]]
        [files]
        "tasks.py" = "./tasks.py"
        "/slider.py" = "./slider.py"
        "/surveycode.py" = ""
        "https://example.com/data.csv" = "./data.csv"
    </py-config> -->
    <py-config>
        [[fetch]]
        files = ['surveycode.py', 'slider.py', 'tasks.py', 'all_contexts.txt']
        from = 'static/'
    </py-config>

    <div class="container">
        <div class="page active" id="page-1" style="width: 60%; min-width: 500;  margin:0 auto; text-align: left;">
            <h2 style="text-align: center;">Welcome to the data survey</h2>
                <p>Dear Prospective participant,</p>
                    Thank you for your time.
                </p>
                <p>Please have a look at the <a href="static/PIS.pdf" target="_blank">Participant Information Sheet</a>.</p>
        </div>
        <div class="page" id="page-2" style="width: 60%; min-width: 500;  margin:0 auto; text-align: left;">
            <h2 style="text-align: center;">Consent form:</h2>
            <p>Do you agree to the following?</p>
    <ul>
        <li>
            <label>I confirm that I have read and understand the <a href="static/PIS.pdf">Participant Information Sheet</a> [REC ID: 244700J-230397471, 2024-10-28]. I have had the opportunity to consider the information, ask questions, and have had these answered satisfactorily.</label>
        </li>
        <li>
            <label>I understand that my participation is voluntary and that I am free to withdraw at any time during the data collection, without giving a reason and without my legal rights being affected.</label>
        </li>
        <li>
            <label>I understand that this study is anonymous and that I am not able to withdraw after submitting my answers.</label>
        </li>
        <li>
            <label>I agree to my personal data and data relating to me collected during the study being processed as described in the Participant Information Sheet.</label>
        </li>
        <li>
            <label>I agree to my anonymous data being used by research teams for future research.</label>
        </li>
        <li>
            <label>I agree to take part in this study.</label>
        </li>
    </ul>
    <label style="text-align: center;"><input type="checkbox" id="agree"> I agree to <strong>all</strong> points above.</label>
</div>
        <div class="page" id="page-3">
            <h2>Detailed instructions</h2>
            <p>Please watch the video before providing your ratings.</p>
        <div class="video-container">
            <video id="mmyVideodd" class="responsive-video" controls>
                <!-- <source id="myVideoSwebm" src="instructions.webm" type="video/webm"> -->
                <source id="myVideoSmp4" src="instructions.mp4" type="video/mp4">
                Your browser does not support the video tag.
            </video>

        </div>
        </div>
        <div class="page" id="page-4">
            <h2>A few details before you start</h2>
            <form>
                <label for="country">Country:</label> &nbsp; <select id="country" name="country" required>
                    <option value="">Select a country</option>
                </select>
                <br/>
                <label for="age">Age:</label> &nbsp; <input type="number" id="age" name="age" min="1" max="120" required>
                <br/>
                Gender  &nbsp;  <select id="gender" name="gender">
                    <option value="">select an option</option>
                    <option value="female">female</option>
                    <option value="male">male</option>
                    <option value="non-binary">non-binary</option>
                    <option value="transgender">transgender</option>
                    <option value="other">other</option>
                    <option value="not-say">prefer not to say</option>
                </select>
                <br/>
            </form>
        </select>
        </div>
        <div class="page" id="page-5">
            <h2 id="myHeader"></h2>
            <video id="myVideo" class="responsive-video" controls>
                <source id="myVideoSource1" src="video.mp4" type="video/mp4">
                <!-- <source id="myVideoSource2" src="video.webm" type="video/webm"> -->
                Your browser does not support the video tag.
            </video>
            <p>Provide the overall quality of the trajectory (efficiency and socialness) considering the following context:<br/><strong><span id="myDescription">This is the description</span></strong></p>
            <canvas id="myCanvas" width="340px" height="120" style="background-color: #ffffffff; touch-action: none;"></canvas>
        </div>
        <div class="buttons">
            <button id="prev-btn">prev</button>
            <button id="next-btn">next</button><br/>
            <button id="cancel-btn">cancel</button>
            <button id="send-btn">send</button>
        </div>
        <h2 id="myCounter"></h2>
    </div>

    <py-script type="py" src="./surveycode.py"></py-script>

    <script>
        let currentPage = 1;
        let questionIndex = 0;
        let answer_set = 0;
        let reload_video = 1;
        let video_watched = 0;

        const pages = document.querySelectorAll('.page');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const cancelBtn = document.getElementById('cancel-btn');
        const sendBtn = document.getElementById('send-btn');
        const checkbox = document.getElementById('agree-checkbox');
        const video = document.getElementById('myVideo');
	    const canvas = document.getElementById('myCanvas');

        function showPage(page) {
            pages.forEach(p => p.classList.remove('active'));
            document.getElementById(`page-${page}`).classList.add('active');
        }

        window.onload = function () {
            const video = document.getElementById('myVideo');
            video.addEventListener("click", function () {
                if (currentPage === 5)
                {
                    if (video.paused) {
                        video.play();
                    }
                }
            });
            window.addEventListener("keydown", function (event) {
                if (currentPage === 5)
                {
                    var key = event.which || event.keyCode;
                    if (key === 32) { // Space bar
                        event.preventDefault();
                        if (video.paused) {
                            video.play();
                        }
                    }
                }
            });
        };

        prevBtn.addEventListener('click', () => {
            count_message = document.getElementById('myCounter');
            count_message.innerHTML = '';

            if (currentPage > 1 && questionIndex <= 0) {
                currentPage--;
                showPage(currentPage);
            } else if (questionIndex > 0) {
                questionIndex -= 1;
                answer_set = 1;
                reload_video = 1;
                video_watched = 1;
            }
        });

        nextBtn.addEventListener('click', () => {
            count_message = document.getElementById('myCounter');
            count_message.innerHTML = '';


            if (currentPage === 1) {
                    currentPage++;
                    showPage(currentPage);
            }
            else if (currentPage === 2) {
                const agree1 = document.getElementById('agree').checked;

                if (!agree1) {
                    alert('Please confirm all agreements to proceed. If you don\'t agree to participate, you can close the website.');
                } else {
                    // All checkboxes are checked, proceed to the next page
                    currentPage++;
                    showPage(currentPage);
                    document.getElementById('mmyVideodd').play();
                }
            }
            else if (currentPage === 3) {
                    currentPage++;
                    showPage(currentPage);
                    document.getElementById('mmyVideodd').pause();
            }
            else if (currentPage === 4) {
                // Validate the form inputs on Page 4
                const country = document.getElementById('country').value;
                const age = document.getElementById('age').value;
                const gender = document.getElementById('gender')
                if (!country) {
                    alert('Please select a country.');
                } else if (!age || age < 18 || age > 120) {
                    if (age < 18)
                    {
                        alert('Only adults can participate in the survey.');
                    }
                    else
                    {
                        alert('Please enter a valid age.');
                    }
                } else if (gender.value === '' || gender.value === 'default'|| gender.value === undefined) {
                    alert('Please select a gender option.');
                } else {
                    // All form fields are valid, go to the next page
                    currentPage++;
                    showPage(currentPage);
                }
            }
            else if (currentPage === 5 )
            {
                if (answer_set === 1)
                {
                    questionIndex += 1;
                    answer_set = 0;
                    reload_video = 1;
                    video_watched = 0;
                    
                    if (questionIndex >= 300)
                    {
                        sendBtn.click();
                    }
                    else
                    {
                        showPage(currentPage);
                    }
                }
                else
                {
                    alert('Please, provide an answer before proceeding to the next trajectory.');
                }
            }
        });

        cancelBtn.addEventListener('click', () => {
            let userConfirmed = confirm("Are you sure you want to delete all data?");
            if (userConfirmed) {
                console.log("User confirmed they want to cancel.");
                window.localStorage.clear();
                window.location.reload();
            } else {
                console.log("User canceled deletion.");
            }
        });

        // Add an event listener for the 'ended' event
        video.addEventListener('ended', function() {
            video_watched = 1;
        });

    // Fetch local country data
    const countryDropdown = document.getElementById('country');

    // Local list of countries
    const countries = [
        { cca2: "GS", name: "South Georgia" },
        { cca2: "GD", name: "Grenada" },
        { cca2: "CH", name: "Switzerland" },
        { cca2: "SL", name: "Sierra Leone" },
        { cca2: "HU", name: "Hungary" },
        { cca2: "TW", name: "Taiwan" },
        { cca2: "WF", name: "Wallis and Futuna" },
        { cca2: "BB", name: "Barbados" },
        { cca2: "PN", name: "Pitcairn Islands" },
        { cca2: "CI", name: "Ivory Coast" },
        { cca2: "TN", name: "Tunisia" },
        { cca2: "IT", name: "Italy" },
        { cca2: "BJ", name: "Benin" },
        { cca2: "ID", name: "Indonesia" },
        { cca2: "CV", name: "Cape Verde" },
        { cca2: "KN", name: "Saint Kitts and Nevis" },
        { cca2: "LA", name: "Laos" },
        { cca2: "BQ", name: "Caribbean Netherlands" },
        { cca2: "UG", name: "Uganda" },
        { cca2: "AD", name: "Andorra" },
        { cca2: "BI", name: "Burundi" },
        { cca2: "ZA", name: "South Africa" },
        { cca2: "FR", name: "France" },
        { cca2: "LY", name: "Libya" },
        { cca2: "MX", name: "Mexico" },
        { cca2: "GA", name: "Gabon" },
        { cca2: "MP", name: "Northern Mariana Islands" },
        { cca2: "MK", name: "North Macedonia" },
        { cca2: "CN", name: "China" },
        { cca2: "YE", name: "Yemen" },
        { cca2: "BL", name: "Saint Barthélemy" },
        { cca2: "GG", name: "Guernsey" },
        { cca2: "SB", name: "Solomon Islands" },
        { cca2: "SJ", name: "Svalbard and Jan Mayen" },
        { cca2: "FO", name: "Faroe Islands" },
        { cca2: "UZ", name: "Uzbekistan" },
        { cca2: "EG", name: "Egypt" },
        { cca2: "SN", name: "Senegal" },
        { cca2: "LK", name: "Sri Lanka" },
        { cca2: "PS", name: "Palestine" },
        { cca2: "BD", name: "Bangladesh" },
        { cca2: "PE", name: "Peru" },
        { cca2: "SG", name: "Singapore" },
        { cca2: "TR", name: "Turkey" },
        { cca2: "AF", name: "Afghanistan" },
        { cca2: "AW", name: "Aruba" },
        { cca2: "CK", name: "Cook Islands" },
        { cca2: "GB", name: "United Kingdom" },
        { cca2: "ZM", name: "Zambia" },
        { cca2: "FI", name: "Finland" },
        { cca2: "NE", name: "Niger" },
        { cca2: "CX", name: "Christmas Island" },
        { cca2: "TK", name: "Tokelau" },
        { cca2: "GW", name: "Guinea-Bissau" },
        { cca2: "AZ", name: "Azerbaijan" },
        { cca2: "RE", name: "Réunion" },
        { cca2: "DJ", name: "Djibouti" },
        { cca2: "KP", name: "North Korea" },
        { cca2: "MU", name: "Mauritius" },
        { cca2: "MS", name: "Montserrat" },
        { cca2: "VI", name: "United States Virgin Islands" },
        { cca2: "CO", name: "Colombia" },
        { cca2: "GR", name: "Greece" },
        { cca2: "HR", name: "Croatia" },
        { cca2: "MA", name: "Morocco" },
        { cca2: "DZ", name: "Algeria" },
        { cca2: "AQ", name: "Antarctica" },
        { cca2: "NL", name: "Netherlands" },
        { cca2: "SD", name: "Sudan" },
        { cca2: "FJ", name: "Fiji" },
        { cca2: "LI", name: "Liechtenstein" },
        { cca2: "NP", name: "Nepal" },
        { cca2: "PR", name: "Puerto Rico" },
        { cca2: "GE", name: "Georgia" },
        { cca2: "PK", name: "Pakistan" },
        { cca2: "MC", name: "Monaco" },
        { cca2: "BW", name: "Botswana" },
        { cca2: "LB", name: "Lebanon" },
        { cca2: "PG", name: "Papua New Guinea" },
        { cca2: "YT", name: "Mayotte" },
        { cca2: "DO", name: "Dominican Republic" },
        { cca2: "NF", name: "Norfolk Island" },
        { cca2: "BV", name: "Bouvet Island" },
        { cca2: "QA", name: "Qatar" },
        { cca2: "MG", name: "Madagascar" },
        { cca2: "IN", name: "India" },
        { cca2: "SY", name: "Syria" },
        { cca2: "ME", name: "Montenegro" },
        { cca2: "SZ", name: "Eswatini" },
        { cca2: "PY", name: "Paraguay" },
        { cca2: "SV", name: "El Salvador" },
        { cca2: "UA", name: "Ukraine" },
        { cca2: "IM", name: "Isle of Man" },
        { cca2: "NA", name: "Namibia" },
        { cca2: "AE", name: "United Arab Emirates" },
        { cca2: "BG", name: "Bulgaria" },
        { cca2: "GL", name: "Greenland" },
        { cca2: "DE", name: "Germany" },
        { cca2: "KH", name: "Cambodia" },
        { cca2: "IQ", name: "Iraq" },
        { cca2: "TF", name: "French Southern and Antarctic Lands" },
        { cca2: "SE", name: "Sweden" },
        { cca2: "CU", name: "Cuba" },
        { cca2: "KG", name: "Kyrgyzstan" },
        { cca2: "RU", name: "Russia" },
        { cca2: "MY", name: "Malaysia" },
        { cca2: "ST", name: "São Tomé and Príncipe" },
        { cca2: "CY", name: "Cyprus" },
        { cca2: "CA", name: "Canada" },
        { cca2: "MW", name: "Malawi" },
        { cca2: "SA", name: "Saudi Arabia" },
        { cca2: "BA", name: "Bosnia and Herzegovina" },
        { cca2: "ET", name: "Ethiopia" },
        { cca2: "ES", name: "Spain" },
        { cca2: "SI", name: "Slovenia" },
        { cca2: "OM", name: "Oman" },
        { cca2: "PM", name: "Saint Pierre and Miquelon" },
        { cca2: "MO", name: "Macau" },
        { cca2: "SM", name: "San Marino" },
        { cca2: "LS", name: "Lesotho" },
        { cca2: "MH", name: "Marshall Islands" },
        { cca2: "SX", name: "Sint Maarten" },
        { cca2: "IS", name: "Iceland" },
        { cca2: "LU", name: "Luxembourg" },
        { cca2: "AR", name: "Argentina" },
        { cca2: "TC", name: "Turks and Caicos Islands" },
        { cca2: "NR", name: "Nauru" },
        { cca2: "CC", name: "Cocos (Keeling) Islands" },
        { cca2: "EH", name: "Western Sahara" },
        { cca2: "DM", name: "Dominica" },
        { cca2: "CR", name: "Costa Rica" },
        { cca2: "AU", name: "Australia" },
        { cca2: "TH", name: "Thailand" },
        { cca2: "HT", name: "Haiti" },
        { cca2: "TV", name: "Tuvalu" },
        { cca2: "HN", name: "Honduras" },
        { cca2: "GQ", name: "Equatorial Guinea" },
        { cca2: "LC", name: "Saint Lucia" },
        { cca2: "PF", name: "French Polynesia" },
        { cca2: "BY", name: "Belarus" },
        { cca2: "LV", name: "Latvia" },
        { cca2: "PW", name: "Palau" },
        { cca2: "GP", name: "Guadeloupe" },
        { cca2: "PH", name: "Philippines" },
        { cca2: "GI", name: "Gibraltar" },
        { cca2: "DK", name: "Denmark" },
        { cca2: "CM", name: "Cameroon" },
        { cca2: "GN", name: "Guinea" },
        { cca2: "BH", name: "Bahrain" },
        { cca2: "SR", name: "Suriname" },
        { cca2: "CD", name: "DR Congo" },
        { cca2: "SO", name: "Somalia" },
        { cca2: "CZ", name: "Czechia" },
        { cca2: "NC", name: "New Caledonia" },
        { cca2: "VU", name: "Vanuatu" },
        { cca2: "SH", name: "Saint Helena, Ascension and Tristan da Cunha" },
        { cca2: "TG", name: "Togo" },
        { cca2: "VG", name: "British Virgin Islands" },
        { cca2: "KE", name: "Kenya" },
        { cca2: "NU", name: "Niue" },
        { cca2: "HM", name: "Heard Island and McDonald Islands" },
        { cca2: "RW", name: "Rwanda" },
        { cca2: "EE", name: "Estonia" },
        { cca2: "RO", name: "Romania" },
        { cca2: "TT", name: "Trinidad and Tobago" },
        { cca2: "GY", name: "Guyana" },
        { cca2: "TL", name: "Timor-Leste" },
        { cca2: "VN", name: "Vietnam" },
        { cca2: "UY", name: "Uruguay" },
        { cca2: "VA", name: "Vatican City" },
        { cca2: "HK", name: "Hong Kong" },
        { cca2: "AT", name: "Austria" },
        { cca2: "AG", name: "Antigua and Barbuda" },
        { cca2: "TM", name: "Turkmenistan" },
        { cca2: "MZ", name: "Mozambique" },
        { cca2: "PA", name: "Panama" },
        { cca2: "FM", name: "Micronesia" },
        { cca2: "IE", name: "Ireland" },
        { cca2: "CW", name: "Curaçao" },
        { cca2: "GF", name: "French Guiana" },
        { cca2: "NO", name: "Norway" },
        { cca2: "AX", name: "Åland Islands" },
        { cca2: "CF", name: "Central African Republic" },
        { cca2: "BF", name: "Burkina Faso" },
        { cca2: "ER", name: "Eritrea" },
        { cca2: "TZ", name: "Tanzania" },
        { cca2: "KR", name: "South Korea" },
        { cca2: "JO", name: "Jordan" },
        { cca2: "MR", name: "Mauritania" },
        { cca2: "LT", name: "Lithuania" },
        { cca2: "UM", name: "United States Minor Outlying Islands" },
        { cca2: "SK", name: "Slovakia" },
        { cca2: "AO", name: "Angola" },
        { cca2: "KZ", name: "Kazakhstan" },
        { cca2: "MD", name: "Moldova" },
        { cca2: "ML", name: "Mali" },
        { cca2: "FK", name: "Falkland Islands" },
        { cca2: "AM", name: "Armenia" },
        { cca2: "WS", name: "Samoa" },
        { cca2: "JE", name: "Jersey" },
        { cca2: "JP", name: "Japan" },
        { cca2: "BO", name: "Bolivia" },
        { cca2: "CL", name: "Chile" },
        { cca2: "US", name: "United States" },
        { cca2: "VC", name: "Saint Vincent and the Grenadines" },
        { cca2: "BM", name: "Bermuda" },
        { cca2: "SC", name: "Seychelles" },
        { cca2: "IO", name: "British Indian Ocean Territory" },
        { cca2: "GT", name: "Guatemala" },
        { cca2: "EC", name: "Ecuador" },
        { cca2: "MQ", name: "Martinique" },
        { cca2: "TJ", name: "Tajikistan" },
        { cca2: "MT", name: "Malta" },
        { cca2: "GM", name: "Gambia" },
        { cca2: "NG", name: "Nigeria" },
        { cca2: "BS", name: "Bahamas" },
        { cca2: "XK", name: "Kosovo" },
        { cca2: "KW", name: "Kuwait" },
        { cca2: "MV", name: "Maldives" },
        { cca2: "SS", name: "South Sudan" },
        { cca2: "IR", name: "Iran" },
        { cca2: "AL", name: "Albania" },
        { cca2: "BR", name: "Brazil" },
        { cca2: "RS", name: "Serbia" },
        { cca2: "BZ", name: "Belize" },
        { cca2: "MM", name: "Myanmar" },
        { cca2: "BT", name: "Bhutan" },
        { cca2: "VE", name: "Venezuela" },
        { cca2: "LR", name: "Liberia" },
        { cca2: "JM", name: "Jamaica" },
        { cca2: "PL", name: "Poland" },
        { cca2: "KY", name: "Cayman Islands" },
        { cca2: "BN", name: "Brunei" },
        { cca2: "KM", name: "Comoros" },
        { cca2: "GU", name: "Guam" },
        { cca2: "TO", name: "Tonga" },
        { cca2: "KI", name: "Kiribati" },
        { cca2: "GH", name: "Ghana" },
        { cca2: "TD", name: "Chad" },
        { cca2: "ZW", name: "Zimbabwe" },
        { cca2: "MF", name: "Saint Martin" },
        { cca2: "MN", name: "Mongolia" },
        { cca2: "PT", name: "Portugal" },
        { cca2: "AS", name: "American Samoa" },
        { cca2: "CG", name: "Republic of the Congo" },
        { cca2: "BE", name: "Belgium" },
        { cca2: "IL", name: "Israel" },
        { cca2: "NZ", name: "New Zealand" },
        { cca2: "NI", name: "Nicaragua" },
        { cca2: "AI", name: "Anguilla" }
];

    // Sort the countries alphabetically
    countries.sort((a, b) => a.name.localeCompare(b.name));

    // Populate the dropdown
    countries.forEach(country => {
        const option = document.createElement('option');
        option.value = country.cca2; // ISO code
        option.textContent = country.name;
        countryDropdown.appendChild(option);
    });

    </script>
</body>
</html>


